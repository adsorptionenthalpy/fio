<pre style="width: 100%; height: 100%; margin:0px; "></pre>

<script src='dist-web/eosjs2-debug.js'></script>
<script src='dist-web/eosjs2-jsonrpc-debug.js'></script>
<script src='dist-web/eosjs2-jssig-debug.js'></script>
<script>
  // parse the requested "name" via GET request token "name"
  var scripts = document.getElementsByTagName( "script" );
  var url_string = scripts[scripts.length - 1].baseURI;
  var url = new URL(url_string);
  var fio_user_name = url.searchParams.get("fio_user_name");
  if (fio_user_name === "") {
    throw new Error("Null or empty fio user name.")
  }
	
	//Get chain name from parameters
  var chain = url.searchParams.get("chain");
  if (chain === "") {
    throw new Error("Null or empty chain.")
  }
	//Get address from parameters
  var address = url.searchParams.get("address");
  if (address === "") {
    throw new Error("Null or empty address.")
  }
	
//remove trailing whitespaces from address
address = address.replace(/^[ ]+|[ ]+$/g,'')
	
	
	//Get private key from parameters
  var key = url.searchParams.get("key"); // private key of user exchange1111
  if (key === "") {
    throw new Error("Null or empty key.")
  }

  let pre = document.getElementsByTagName('pre')[0];
	
  // define key and create signature
  const defaultPrivateKey = key;
  const rpc = new eosjs2_jsonrpc.JsonRpc('http://52.14.221.174:8889');
  const signatureProvider = new eosjs2_jssig.default([defaultPrivateKey]);
  const api = new eosjs2.Api({ rpc, signatureProvider });

  // Make the transaction and return result
  (async () => {
    try {
      const result = await api.transact({
        actions: [{
            account: 'exchange1111',
            name: 'addaddress',
            authorization: [{
                actor: 'exchange1111',
                permission: 'active',
            }],
            data: {
                fio_user_name: fio_user_name,
                chain: chain,
                address: address
            },
        }]
      }, {
        blocksBehind: 3,
        expireSeconds: 30,
      });
      pre.textContent += '\n\nTransaction pushed!\n\n' + JSON.stringify(result, null, 2);
    } catch (e) {
      pre.textContent = '\nCaught exception: ' + e;
      if (e instanceof eosjs2_jsonrpc.RpcError)
        pre.textContent += '\n\n' + JSON.stringify(e.json, null, 2);
    }
  })();
</script>
