<pre style="width: 100%; height: 100%; margin:0px; "></pre>

<script src='dist-web/eosjs2-debug.js'></script>
<script src='dist-web/eosjs2-jsonrpc-debug.js'></script>
<script src='dist-web/eosjs2-jssig-debug.js'></script>
<script>
	
	
  // PRECONDITION: GetTotalAssets has been called and the sendaccount has the funds

  // parse the requested "name" via GET request token "name"
  var scripts = document.getElementsByTagName( "script" );
  var url_string = scripts[scripts.length - 1].baseURI;
  var url = new URL(url_string);
  var toaccount = url.searchParams.get("toaccount");
  if (toaccount === "") {
    throw new Error("Null or empty recipient account name.")
  }

  var fromaccount = url.searchParams.get("fromaccount");
  if (toaccount === "") {
    throw new Error("Null or empty sender account name.")
  }
	
  var qty = url.searchParams.get("qty");
  if (qty === "") {
    throw new Error("Null or empty quantity.")
  }
	
  //Get private key from parameters
  var key = url.searchParams.get("key"); // private key of the user sending funds!
  if (key === "") {
    throw new Error("Null or empty key.")
  }
 	
	
	 //Get memo field from parameters
  var memo = url.searchParams.get("memo"); // private key of the user sending funds!
  //Check the memo
  if (memo === "") {
    //Do nothing, we're allowing blank memo for now.
  }
 	
	//remove trailing whitespaces from inputs (except for memo)
	toaccount = toaccount.replace(/^[ ]+|[ ]+$/g,'');
	fromaccount = fromaccount.replace(/^[ ]+|[ ]+$/g,'');
	key = key.replace(/^[ ]+|[ ]+$/g,'');
	qty = qty.replace(/^[ ]+|[ ]+$/g,'');
	qty = qty + " FIO"; //lave the whitespace

  let pre = document.getElementsByTagName('pre')[0];
	
  // define key and create signature. This is only created one time in a single instance
  const defaultPrivateKey = key;
  const rpc = new eosjs2_jsonrpc.JsonRpc('http://52.14.221.174:8889');
  const signatureProvider = new eosjs2_jssig.default([defaultPrivateKey]);
  const api = new eosjs2.Api({ rpc, signatureProvider });

	
	
  // Make the transaction and return result, this can be changed and pushed as many times 
  // as needed as long as the api instance has been signed by the proper signature provider

	
(async () => {
    try {
      const result = await api.transact({
        actions: [{
            account: 'fioio.token',
            name: 'transfer',
            authorization: [{
                actor: fromaccount,
                permission: 'active',
            }],
            data: {
                from: fromaccount,
                to: toaccount,
                quantity: qty, 
				memo: memo,
            },
        }]
      }, {
        blocksBehind: 3,
        expireSeconds: 30,
      });
      pre.textContent += '\n\nTransaction pushed!\n\n' + JSON.stringify(result, null, 2);
    } catch (e) {
      pre.textContent = '\nCaught exception: ' + e;
      if (e instanceof eosjs2_jsonrpc.RpcError)
        pre.textContent += '\n\n' + JSON.stringify(e.json, null, 2);
    }
  })();
</script>
